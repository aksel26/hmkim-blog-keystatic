---
title: 'WebRTC setRemoteDescription ì—ëŸ¬ í•´ê²°ê¸°: "Called in wrong state: stable"'
summary: WebRTC Signaling ë²„ê·¸ë¥¼ í•´ê²°í•˜ëŠ” ê³¼ì •ì„ ì‘ì„±í•œ ê¸€ì…ë‹ˆë‹¤.
keywords:
  - Tech
status: published
tags:
  - WebRTC
  - Javascript
  - Socket
createdAt: 2026-01-02
updatedAt: 2026-01-02
---
## ğŸ”¥ ë¬¸ì œ ìƒí™©

ì‹œí—˜ ê°ë… í”Œë«í¼ì„ ê°œë°œí•˜ë˜ ì¤‘, ì‘ì‹œìì™€ ê°ë…ê´€ ê°„ ì‹¤ì‹œê°„ ì˜ìƒ ì—°ê²°ì„ ìœ„í•´ WebRTCë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.

ê·¸ëŸ°ë° íŠ¹ì • ìƒí™©ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:

```javascript
Uncaught (in promise) InvalidStateError: Failed to execute 'setRemoteDescription'
on 'RTCPeerConnection': Failed to set remote answer sdp:
Called in wrong state: stable


```

ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë³´ë©´ RTCPeerConnectionì´ `stable` ìƒíƒœì¼ ë•Œ answerë¥¼ ì„¤ì •í•˜ë ¤ë‹¤ ì‹¤íŒ¨í•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ” ì›ì¸ ë¶„ì„

### WebRTC Signaling State ì´í•´í•˜ê¸°

WebRTCëŠ” peer ê°„ ì—°ê²°ì„ ë§ºê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ìƒíƒœ(signaling state)ë¥¼ ê±°ì¹©ë‹ˆë‹¤:

1. **stable**: ì—°ê²°ì´ ì™„ë£Œë˜ì—ˆê±°ë‚˜ ì•„ì§ ì‹œì‘í•˜ì§€ ì•Šì€ ìƒíƒœ
1. **have-local-offer**: ë¡œì»¬ì—ì„œ offerë¥¼ ìƒì„±í•˜ê³  ì„¤ì •í•œ ìƒíƒœ
1. **have-remote-offer**: ì›ê²©ì—ì„œ offerë¥¼ ë°›ì•„ ì„¤ì •í•œ ìƒíƒœ
1. **have-local-pranswer**: ì„ì‹œ answerë¥¼ ë¡œì»¬ì— ì„¤ì •í•œ ìƒíƒœ
1. **have-remote-pranswer**: ì„ì‹œ answerë¥¼ ì›ê²©ì—ì„œ ë°›ì€ ìƒíƒœ

### ì •ìƒì ì¸ WebRTC Offer-Answer íë¦„

```
[Offerer]                              [Answerer]
   |                                        |
   |-- createOffer() ----------------------|
   |-- setLocalDescription(offer) ---------|
   |   (state: have-local-offer)           |
   |                                        |
   |-- send offer -----------------------â†’ |
   |                                        |-- setRemoteDescription(offer)
   |                                        |   (state: have-remote-offer)
   |                                        |-- createAnswer()
   |                                        |-- setLocalDescription(answer)
   |                                        |   (state: stable)
   |                                        |
   | â†--------------------- send answer ---|
   |                                        |
   |-- setRemoteDescription(answer) -------|
   |   (state: stable) âœ…                  |


```

### ë¬¸ì œì˜ ì›ì¸

ìš°ë¦¬ ì½”ë“œì—ì„œëŠ” `USER_ANSWER` ì´ë²¤íŠ¸ë¥¼ ë°›ì•˜ì„ ë•Œ **ë¬´ì¡°ê±´** `setRemoteDescription(answer)`ë¥¼ í˜¸ì¶œí•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤:

```javascript
socket?.on(SOCKET_EVENT.USER_ANSWER, (peerId, description) => {
  peerConnections[peerId].setRemoteDescription(description); // âŒ ìƒíƒœ ì²´í¬ ì—†ìŒ
  // ...
});


```

ì´ë ‡ê²Œ ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œ ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **ì¤‘ë³µëœ answerë¥¼ ë°›ì•˜ì„ ë•Œ**: ì´ë¯¸ stable ìƒíƒœì¸ë° ë˜ answerë¥¼ ì„¤ì •í•˜ë ¤ê³  ì‹œë„
- **offerë¥¼ ë³´ë‚´ì§€ ì•Šì€ ìƒíƒœì—ì„œ answerë¥¼ ë°›ì•˜ì„ ë•Œ**: stable ìƒíƒœì—ì„œ ë°”ë¡œ answer ì„¤ì • ì‹œë„
- **ë¹„ë™ê¸° ì²˜ë¦¬ ì¤‘ íƒ€ì´ë° ì´ìŠˆ**: ë„¤íŠ¸ì›Œí¬ ì§€ì—°ìœ¼ë¡œ ì¸í•´ ì˜ˆìƒì¹˜ ëª»í•œ ìˆœì„œë¡œ ì´ë²¤íŠ¸ ìˆ˜ì‹ 

## âœ… í•´ê²° ë°©ë²•

### 1. Signaling State ê²€ì¦ ì¶”ê°€

answerë¥¼ ì„¤ì •í•˜ê¸° ì „ì— í˜„ì¬ ì—°ê²°ì´ ì˜¬ë°”ë¥¸ ìƒíƒœ(`have-local-offer`)ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤:

```javascript
socket?.on(SOCKET_EVENT.USER_ANSWER, async (peerId, description) => {
  // 1ï¸âƒ£ PeerConnection ì¡´ì¬ ì—¬ë¶€ í™•ì¸
  if (!peerConnections[peerId]) {
    console.error(`[WebRTC] PeerConnection ${peerId} not found`);
    return;
  }

  // 2ï¸âƒ£ í˜„ì¬ Signaling State í™•ì¸
  const signalingState = peerConnections[peerId].signalingState;
  console.log(`[WebRTC] Current signaling state for ${peerId}:`, signalingState);

  // 3ï¸âƒ£ have-local-offer ìƒíƒœì¼ ë•Œë§Œ answer ì„¤ì •
  if (signalingState === 'have-local-offer') {
    try {
      await peerConnections[peerId].setRemoteDescription(description);
      console.log(`[WebRTC] Remote description set successfully for ${peerId}`);
    } catch (error) {
      console.error(`[WebRTC] Failed to set remote description for ${peerId}:`, error);
      return;
    }
  } else {
    console.warn(
      `[WebRTC] Cannot set remote answer in ${signalingState} state. ` +
      `Expected 'have-local-offer'`
    );
    return;
  }

  // 4ï¸âƒ£ ontrack ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
  peerConnections[peerId].ontrack = (event) => {
    // ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬...
  };
});


```

### 2. Offer ì²˜ë¦¬ ì‹œ ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”

offerë¥¼ ë°›ì•„ì„œ answerë¥¼ ìƒì„±í•˜ëŠ” ë¶€ë¶„ì—ë„ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤:

```javascript
peerConnections[peerId]
  .setRemoteDescription(description)
  .then(() => peerConnections[peerId].createAnswer())
  .then((sdp) => peerConnections[peerId].setLocalDescription(sdp))
  .then(() => {
    socket.emit(
      SOCKET_EVENT.ANSWER,
      myPeerId,
      socketId,
      peerConnections[peerId].localDescription
    );
  })
  .catch((error) => {
    // âœ… ì—ëŸ¬ ìºì¹˜ ì¶”ê°€
    console.error(`[WebRTC] Error in offer-answer exchange for ${peerId}:`, error);
  });


```

### 3. ëª¨ë°”ì¼ ì—°ê²°ì—ë„ ë™ì¼í•˜ê²Œ ì ìš©

ëª¨ë°”ì¼ í™”ë©´ ê³µìœ  ê¸°ëŠ¥ì—ì„œë„ ê°™ì€ íŒ¨í„´ìœ¼ë¡œ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤:

```javascript
socket?.on(
  SOCKET_EVENT.USER_OFFER,
  async (peerId, socketId, videoAnswer, description) => {
    peerConnections[peerId] = new RTCPeerConnection(RTCConfig);

    if (videoAnswer === "Y") {
      my_video_stream
        .getTracks()
        .forEach((track) =>
          peerConnections[peerId].addTrack(track, my_video_stream)
        );
    }

    // âœ… try-catchë¡œ ì „ì²´ í”„ë¡œì„¸ìŠ¤ ê°ì‹¸ê¸°
    try {
      await peerConnections[peerId].setRemoteDescription(description);
      const answer = await peerConnections[peerId].createAnswer();
      await peerConnections[peerId].setLocalDescription(answer);
      socket?.emit(SOCKET_EVENT.ANSWER, myPeerId, socketId, answer);
    } catch (error) {
      console.error(`[WebRTC Mobile] Error in offer-answer exchange:`, error);
      return;
    }

    // ontrack í•¸ë“¤ëŸ¬ ì„¤ì •...
  }
);


```

## ğŸ“Š ìˆ˜ì • íš¨ê³¼

### Before âŒ

- íŠ¹ì • ìƒí™©ì—ì„œ `InvalidStateError` ë°œìƒ
- ì—ëŸ¬ ë°œìƒ ì‹œ ì—°ê²° ì‹¤íŒ¨ë¡œ ì´ì–´ì§
- ë””ë²„ê¹…ì´ ì–´ë ¤ì›€ (ì—ëŸ¬ë§Œ í‘œì‹œë˜ê³  ì›ì¸ íŒŒì•… ë¶ˆê°€)

### After âœ…

- Signaling stateë¥¼ ì²´í¬í•˜ì—¬ ì˜ëª»ëœ ìƒíƒœì—ì„œì˜ í˜¸ì¶œ ë°©ì§€
- ì—ëŸ¬ ë°œìƒ ì‹œ gracefulí•˜ê²Œ ì²˜ë¦¬
- ìƒì„¸í•œ ë¡œê·¸ë¡œ ë””ë²„ê¹… ìš©ì´
- ì—°ê²° ì•ˆì •ì„± í–¥ìƒ

## ğŸ¯ í•µì‹¬ í¬ì¸íŠ¸

1. **WebRTCëŠ” ìƒíƒœ ê¸°ë°˜ í”„ë¡œí† ì½œ**: ê° ë™ì‘ì€ íŠ¹ì • ìƒíƒœì—ì„œë§Œ ìœ íš¨í•©ë‹ˆë‹¤
1. **Signaling State í™•ì¸ í•„ìˆ˜**: `setRemoteDescription` í˜¸ì¶œ ì „ ë°˜ë“œì‹œ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”
1. **ë¹„ë™ê¸° ì²˜ë¦¬ ì£¼ì˜**: WebRTC ì‘ì—…ì€ ëª¨ë‘ ë¹„ë™ê¸°ì´ë¯€ë¡œ `async/await`ë¡œ ìˆœì„œë¥¼ ë³´ì¥í•˜ì„¸ìš”
1. **ì—ëŸ¬ ì²˜ë¦¬ëŠ” í•„ìˆ˜**: Promise rejectionì„ í•­ìƒ ì²˜ë¦¬í•˜ì—¬ ì•ˆì •ì„±ì„ ë†’ì´ì„¸ìš”

## ğŸ’¡ ê²°ë¡ 

WebRTCë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ë‹¨ìˆœíˆ APIë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì„ ë„˜ì–´ì„œ, **ì—°ê²°ì˜ ìƒíƒœ(state)ë¥¼ ì´í•´í•˜ê³  ê´€ë¦¬**í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

íŠ¹íˆ ì‹¤ì‹œê°„ í†µì‹  í™˜ê²½ì—ì„œëŠ” ë„¤íŠ¸ì›Œí¬ ì§€ì—°, ì¤‘ë³µ ë©”ì‹œì§€ ë“± ì˜ˆìƒì¹˜ ëª»í•œ ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë°©ì–´ì  í”„ë¡œê·¸ë˜ë°ì´ í•„ìš”í•©ë‹ˆë‹¤.

ì´ë²ˆ ìˆ˜ì •ìœ¼ë¡œ ìš°ë¦¬ í”Œë«í¼ì˜ WebRTC ì—°ê²° ì•ˆì •ì„±ì´ í¬ê²Œ í–¥ìƒë˜ì—ˆê³ , í–¥í›„ ìœ ì‚¬í•œ ë¬¸ì œê°€ ë°œìƒí•´ë„ ë¡œê·¸ë¥¼ í†µí•´ ë¹ ë¥´ê²Œ ì›ì¸ì„ íŒŒì•…í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

---

**ì°¸ê³  ìë£Œ**

- [MDN - RTCPeerConnection.signalingState](https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/signalingState)
- [MDN - RTCPeerConnection.setRemoteDescription()](https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/setRemoteDescription)
- [WebRTC Signaling and Negotiation](https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling)
